{% from 'macros.html' import glyphicon %}
{% from 'macros.html' import js_bool %}
{% from 'macros.html' import upload_form %}
{% from 'macros.html' import render_share_form %}
{% extends "base.html" %}
{% block title %}Document{% endblock %}
{% block content %}

{% if doc.title %}
<h1>{{doc.title}}</h1>
{% endif %}

<div id="docview" class="col-md-9"></div>

<div class="col-md-3">
<div id="exitfullscreen">
    <div class="list-group">
        <a id="fullscreen_button_exit" href="#" class="list-group-item">
            {{ glyphicon('resize-small') }}
            Exit fullscreen
        </a>
    </div>
</div>
<div id="subnav" data-spy="affix">

    <div class="list-group">
        <a id="fullscreen_button" href="#" class="list-group-item">
            {{ glyphicon('fullscreen') }}
            Full screen
        </a>
        <a href="{{url_for('.view_list', id=doc.id)}}" class="list-group-item">
            {{ glyphicon('list') }}
            List mode
        </a>
{% if can_edit %}
        <a href="{{url_for('document.edit', id=doc.id)}}" class="list-group-item">
            {{ glyphicon('pencil') }}
            Edit
        </a>
{% endif %}
        <a href="#" class="list-group-item" id="share_link">
            {{ glyphicon('share') }}
            Generate a review link
        </a>

    </div>
    <h3>{{ glyphicon('eye-open') }} View</h3>

    <div class="btn-group">
        <button class="view-states-btn btn btn-default" data-view="nothing">Nothing</button>
        <button class="view-states-btn btn btn-default" data-view="only-open">Only open</button>
        <button class="view-states-btn btn btn-default" data-view="everything">Everything</button>
    </div>

    <h3>{{ glyphicon('pencil') }} History</h3>

    <p>
    <a href="{{url_for('.view_revisions', id=doc.id)}}">Revisions</a>
    </p>

    <p>
    <a href="#" id="upload_link">Upload a new version</a>
    </p>

    <div id="upload_dialog" title="Upload a new version">
        {{ upload_form (form_up, url_for('.upload', revises=doc.id)) }}
    </div>
    <div id="share_dialog" title="Generate a review link">
        {{ render_share_form(form_share) }}
    </div>

    <h3>{{ glyphicon('comment') }} Comments</h3>
    <form method="POST" action="{{ url_for('comment.new') }}" id="post_comment_form">
        {{form_comm.hidden_tag()}}
        <p>{{form_comm.comment()}}</p>
        {{form_comm.docid()}}
        <p><input type="submit" value="Comment"></p>
    </form>
    <ul id="comments">
        {% for comment in comments %}
            <li>
            {{comment.text}}
            </li>
        {% endfor %}
    </ul>
</div>
</div>

{% endblock %}

{% block js_end %}
<script type="text/javascript">
$( document ).ready(function(){
    PDFJS.workerSrc = "{{url_for('static', filename='vendor/pdfjs-' + config.X_PDFJS_VERSION + '-dist/build/pdf.worker.js')}}";
    view_init({{doc.id}}, "{{doc.filetype}}", {{js_bool(readOnly)}});
});
</script>
{% endblock %}
